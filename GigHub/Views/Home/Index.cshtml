@model GigHub.ViewModels.GigsViewModel
@{
    ViewBag.Title = "Home Page";
}


@* Search Gig Part *@
@using (@Html.BeginForm("Search", "Home", "Post"))
{
    <div class="form-group">
        <div class="input-group" style="width: 300px">
            @Html.TextBoxFor(m => m.SearchTerm, new { @class = "form-control no-border", @placeholder = "Search by Artist" })
            <span class="input-group-addon">
                <i class="glyphicon glyphicon-search"></i>
            </span>
        </div>
    </div>
}
@* End Of Search Gig Part *@

<ul class="gigs voffset" style="list-style: none;  ">
    @foreach (var gig in Model.UpComingGigs)
    {
        <li style="position: relative;margin-bottom: 30px;">
            <div class="date">
                <div class="month">
                    @gig.DateTime.ToString("MMM")
                </div>
                <div class="day">
                    @gig.DateTime.ToString("d ")
                </div>
            </div>

            <div class="details" style="position: absolute;top: 0;left: 100px;">
                <span class="artist">
                    @*@gig.Artist.Name*@
                    @*@Html.ActionLink(gig.Venue, "GetGigDetails", new {Id = gig.Id })*@
                    <a href="@Url.Action("GetGigDetails", "Gigs", new { id = gig.Id }) "> @gig.Artist.Name </a>
                </span>
                <span class="genere">
                    @gig.Genere.Name
                </span>
                @if (Model.IsAuthenticated)
                {

                    <button FolloweeId="@gig.ArtistId" id="btnFollowing" class="btn btn-link btn-sm pull-right" style="margin-left: 16px;">Following ?</button>
                    if (Model.MyAttendences.Contains(gig.Id))
                    {
                        <button gigId="@gig.Id"  class="btn btn-success  pull-right btnGoing" style="margin-left: 16px;">Going</button>
                    }
                    else
                    {
                        <button gigId="@gig.Id"  class="btn btn-default btn-sm pull-right btnGoing" style="margin-left: 16px;">Not Going</button>

                    }
                }

            </div>

        </li>
    }
</ul>

@section scripts
{
    <script>
        $(document).ready(function() {
            $(".btnGoing").click(function (e) {
           
                var button = $(e.target);
                debugger;
                if (button.hasClass('btn-default')) // toggle to isGoing
                {
                
                    $.post("/api/Attendece",
                            { GigId: $(button).attr("gigId"), passedParam2: 1, passedParam3: "Hello Text" })
                        .done(function() {
                            button.text('Going').removeClass('btn-default').addClass('btn-success');
                        })
                        .fail(function(parameters) {
                            button.text('Failed To Update').addClass('btn-danger');
                        })
                } else {
                    debugger;
             
                    $.ajax({
                        url: "/api/Attendece/" + button.attr("gigId"),
                        method: "DELETE"
                    }).done(function() {
                        button.text('Going ?').removeClass('btn-success').addClass('btn-default');
                    }).fail(function() {
                        alert('Something went wrong');
                    })

                }
            });

            $("#btnFollowing").click(function(e) {
                debugger;
                $.post("/api/Following", { FolloweeId: $(e.target).attr("FolloweeId") })
                    .done(function() {
                        $('#btnFollowing').text('Following').removeClass('btn-default').addClass('btn-success');
                    })
                    .fail(function(parameters) {
                        $('#btnFollowing').text('Failed To Update').addClass('btn-danger');
                    })

            });
        });
    </script>

}
@* Getting Apr *@
@* Getting The Day => d + space  *@
@*use this link to enable zen coding https://bit.ly/2BIbJNF*@
@*(div.date>div.month +div.day)+(div.details>span.artist+span.genere) and press tab will be evaluate to below divs*@